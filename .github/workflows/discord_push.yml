name: Discord Push Notification

on:
  push:

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Send Discord message
        env:
          WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK }}
          COMMIT_MESSAGE: ${{ github.event.head_commit.message }}
          COMMIT_AVATAR: ${{ github.event.head_commit.author.avatar_url }}
        run: |
          # Use default avatar if none
          if [ -z "$COMMIT_AVATAR" ]; then
            COMMIT_AVATAR="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
          fi

          curl -H "Content-Type: application/json" \
               -X POST \
               -d "{
                 \"username\":\"GitHub\",
                 \"avatar_url\":\"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png\",
                 \"embeds\":[{
                   \"author\":{\"name\":\"New Commit\",\"icon_url\":\"$COMMIT_AVATAR\"},
                   \"description\":\"$COMMIT_MESSAGE\",
                   \"url\":\"\",
                   \"color\": 7506394,
                   \"timestamp\":\"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"                 
                 }]
               }" $WEBHOOK_URL
